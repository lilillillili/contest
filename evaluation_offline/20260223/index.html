<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* ---------------------------------- */
    /* ğŸ¨ ê¸°ë³¸ ìŠ¤íƒ€ì¼ (ë°ìŠ¤í¬íƒ‘) */
    /* ---------------------------------- */
    body { font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif; margin: 20px; }
    h2 { padding-bottom: 10px; border-bottom: 2px solid #333; }
    table { border-collapse: collapse; width: 100%; table-layout: fixed; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; vertical-align: middle; }
    th { background-color: #f4f4f4; font-weight: bold; }
    
    /* í‰ê°€í•­ëª© ì—´ ìŠ¤íƒ€ì¼ */
    .category-col { background-color: #fafafa; font-weight: bold; }
    
    /* ì„¸ë¶€ í‰ê°€ ëª©í‘œ ì—´ ìŠ¤íƒ€ì¼ */
    .detail-col { background-color: #fff; text-align: left; padding-left: 15px; }
    
    /* ë°°ì  ì—´ ìŠ¤íƒ€ì¼ */
    .score-col { background-color: #fafafa; font-weight: bold; }
    
    /* ê¸°ê´€ë³„ ì…ë ¥ ì—´ */
    .institute-col { background-color: #fff; }
    
    input[type="number"] { 
      width: 90%; 
      padding: 8px; 
      font-size: 16px; 
      box-sizing: border-box;
      text-align: center;
    }
    
    input[type="text"] {
      width: 100%;
      padding: 8px;
      font-size: 15px;
      box-sizing: border-box;
    }
    
    button { 
      padding: 12px 25px; 
      background-color: #4d79ff; 
      color: white; 
      border: none; 
      cursor: pointer; 
      font-size: 16px; 
      font-weight: bold; 
      margin-top: 15px;
    }
    button:hover { background-color: #3a5bcc; }
    #message { margin-top: 15px; font-weight: bold; font-size: 16px; }
    .judge-section { margin-bottom: 15px; }
    .judge-section label { font-size: 16px; font-weight: bold; }
    .judge-section input { width: 180px; }

    /* ---------------------------------- */
    /* âœï¸ ì„œëª… ìº”ë²„ìŠ¤ ìŠ¤íƒ€ì¼ */
    /* ---------------------------------- */
    .signature-section {
      margin-top: 30px;
      border: 2px solid #4d79ff;
      padding: 20px;
      border-radius: 8px;
    }
    .signature-section h3 {
      margin-top: 0;
      color: #333;
    }
    #signatureCanvas {
      border: 2px solid #333;
      cursor: crosshair;
      display: block;
      margin: 10px auto;
      background-color: white;
      touch-action: none;
    }
    .signature-buttons {
      text-align: center;
      margin-top: 10px;
    }
    .signature-buttons button {
      margin: 0 5px;
      padding: 10px 20px;
      font-size: 14px;
    }
    #clearBtn {
      background-color: #ff6b6b;
    }
    #clearBtn:hover {
      background-color: #cc5555;
    }

    /* í•©ê³„ í–‰ ìŠ¤íƒ€ì¼ */
    .total-row {
      background-color: #f0f0f0;
      font-weight: bold;
    }

    /* ---------------------------------- */
    /* ğŸ“± ëª¨ë°”ì¼ ë°˜ì‘í˜• */
    /* ---------------------------------- */
    @media (max-width: 768px) {
      table thead {
        display: none;
      }
      
      table, tbody, tr, td {
        display: block;
        width: 100%;
        box-sizing: border-box;
      }
      
      tbody tr {
        margin-bottom: 15px;
        border: 2px solid #4d79ff;
        padding: 5px;
      }
      
      tbody td {
        padding-left: 45%;
        text-align: right;
        position: relative;
        border: none;
        border-bottom: 1px dotted #ccc;
      }
      
      tbody td:last-child {
        border-bottom: 0;
      }
      
      tbody td:before {
        content: attr(data-label); 
        position: absolute;
        left: 10px;
        width: calc(45% - 15px);
        text-align: left;
        font-weight: bold;
        white-space: nowrap;
        font-size: 14px;
        color: #333;
      }

      input[type="number"], input[type="text"], select {
        width: 100%;
        font-size: 16px;
      }

      #signatureCanvas {
        width: 100%;
        height: 200px;
      }
    }
  </style>
</head>
<body>

  <h2>ì‹ ì‚°ì—…ìœµí•©í˜•ì„ë² ë””ë“œì‹œìŠ¤í…œì „ë¬¸ì¸ë ¥ì–‘ì„±ì‚¬ì—… 5ì°¨ë…„ë„ ìì²´í‰ê°€ ê°œë³„ ì‹¬ì‚¬í‘œ</h2>
  
  <form id="scoreForm">
    <div class="judge-section">
      <label for="judgeName">ì‹¬ì‚¬ìœ„ì› ì„±ëª…: </label>
      <input type="text" id="judgeNameInput" name="judgeName" required>
    </div>

    <table>
      <thead>
        <tr>
          <th rowspan="2">í‰ê°€í•­ëª©</th>
          <th colspan="2">ì •ì„±(100)</th>
          <th rowspan="2">ë°°ì </th>
          <th rowspan="2">í•œêµ­ì „ìê¸°ìˆ ì—°êµ¬ì›</th>
          <th rowspan="2">ì¸í•˜ëŒ€í•™êµ</th>
          <th rowspan="2">í•œêµ­í•­ê³µëŒ€í•™êµ</th>
          <th rowspan="2">ê´‘ìš´ëŒ€í•™êµ</th>
        </tr>
        <tr>
          <th>ì¶”ì§„ ì‹¤ì  (ì •ì„±)</th>
          <th>í–¥í›„ ê³„íš (ì •ì„±)</th>
        </tr>
      </thead>
      <tbody>
        <!-- ì„±ê³¼ ëª©í‘œ ë‹¬ì„± ìˆ˜ì¤€ -->
        <tr>
          <td rowspan="2" class="category-col" data-label="í‰ê°€í•­ëª©">5ì°¨ë…„ë„<br>ì¶”ì§„ ì‹¤ì <br>(ì •ì„±)</td>
          <td colspan="2" class="detail-col" data-label="ì„¸ë¶€í•­ëª©">ì„±ê³¼ ëª©í‘œ ë‹¬ì„± ìˆ˜ì¤€</td>
          <td class="score-col" data-label="ë°°ì ">25</td>
          <td class="institute-col" data-label="í•œêµ­ì „ìê¸°ìˆ ì—°êµ¬ì›">
            <input type="number" name="keti_score1" min="0" max="25" oninput="calculateInstitute('keti')" required>
          </td>
          <td class="institute-col" data-label="ì¸í•˜ëŒ€í•™êµ">
            <input type="number" name="inha_score1" min="0" max="25" oninput="calculateInstitute('inha')" required>
          </td>
          <td class="institute-col" data-label="í•œêµ­í•­ê³µëŒ€í•™êµ">
            <input type="number" name="kau_score1" min="0" max="25" oninput="calculateInstitute('kau')" required>
          </td>
          <td class="institute-col" data-label="ê´‘ìš´ëŒ€í•™êµ">
            <input type="number" name="kwu_score1" min="0" max="25" oninput="calculateInstitute('kwu')" required>
          </td>
        </tr>
        
        <!-- ì„±ê³¼ê´€ë¦¬ ë° í™˜ë¥˜ ì²´ê³„ì˜ ìš°ìˆ˜ì„± -->
        <tr>
          <td colspan="2" class="detail-col" data-label="ì„¸ë¶€í•­ëª©">ì„±ê³¼ê´€ë¦¬ ë° í™˜ë¥˜ ì²´ê³„ì˜ ìš°ìˆ˜ì„±</td>
          <td class="score-col" data-label="ë°°ì ">35</td>
          <td class="institute-col" data-label="í•œêµ­ì „ìê¸°ìˆ ì—°êµ¬ì›">
            <input type="number" name="keti_score2" min="0" max="35" oninput="calculateInstitute('keti')" required>
          </td>
          <td class="institute-col" data-label="ì¸í•˜ëŒ€í•™êµ">
            <input type="number" name="inha_score2" min="0" max="35" oninput="calculateInstitute('inha')" required>
          </td>
          <td class="institute-col" data-label="í•œêµ­í•­ê³µëŒ€í•™êµ">
            <input type="number" name="kau_score2" min="0" max="35" oninput="calculateInstitute('kau')" required>
          </td>
          <td class="institute-col" data-label="ê´‘ìš´ëŒ€í•™êµ">
            <input type="number" name="kwu_score2" min="0" max="35" oninput="calculateInstitute('kwu')" required>
          </td>
        </tr>

        <!-- ê³„íš ìˆ˜ë¦½ì˜ ì ì ˆì„± -->
        <tr>
          <td rowspan="2" class="category-col" data-label="í‰ê°€í•­ëª©">ì´ê´„ (1~4ì°¨ë…„ë„)<br>ì¶”ì§„ ì‹¤ì <br>(ì •ì„±)</td>
          <td colspan="2" class="detail-col" data-label="ì„¸ë¶€í•­ëª©">ê³„íš ìˆ˜ë¦½ì˜ ì ì ˆì„±</td>
          <td class="score-col" data-label="ë°°ì ">
            <div style="text-align: center;">25</div>
          </td>
          <td class="institute-col" data-label="í•œêµ­ì „ìê¸°ìˆ ì—°êµ¬ì› (40ì )">
            <input type="number" name="keti_score3" min="0" max="40" oninput="calculateInstitute('keti')" required>
            <div style="font-size: 14px; font-weight: bold; color: #333; margin-top: 3px;">(40ì )</div>
          </td>
          <td class="institute-col" data-label="ì¸í•˜ëŒ€í•™êµ">
            <input type="number" name="inha_score3" min="0" max="25" oninput="calculateInstitute('inha')" required>
          </td>
          <td class="institute-col" data-label="í•œêµ­í•­ê³µëŒ€í•™êµ">
            <input type="number" name="kau_score3" min="0" max="25" oninput="calculateInstitute('kau')" required>
          </td>
          <td class="institute-col" data-label="ê´‘ìš´ëŒ€í•™êµ">
            <input type="number" name="kwu_score3" min="0" max="25" oninput="calculateInstitute('kwu')" required>
          </td>
        </tr>

        <!-- ì·¨ì—… ì—°ê³„ ë° ì„±ê³¼ í™•ì‚°ì˜ ì ì ˆì„± -->
        <tr>
          <td colspan="2" class="detail-col" data-label="ì„¸ë¶€í•­ëª©">ì·¨ì—… ì—°ê³„ ë° ì„±ê³¼ í™•ì‚°ì˜ ì ì ˆì„±</td>
          <td class="score-col" data-label="ë°°ì ">15</td>
          <td class="institute-col" data-label="í•œêµ­ì „ìê¸°ìˆ ì—°êµ¬ì›" style="background-color: #e8e8e8;">
            <div style="color: #666;">í•´ë‹¹ì—†ìŒ</div>
            <input type="hidden" name="keti_score4" value="0">
          </td>
          <td class="institute-col" data-label="ì¸í•˜ëŒ€í•™êµ">
            <input type="number" name="inha_score4" min="0" max="15" oninput="calculateInstitute('inha')" required>
          </td>
          <td class="institute-col" data-label="í•œêµ­í•­ê³µëŒ€í•™êµ">
            <input type="number" name="kau_score4" min="0" max="15" oninput="calculateInstitute('kau')" required>
          </td>
          <td class="institute-col" data-label="ê´‘ìš´ëŒ€í•™êµ">
            <input type="number" name="kwu_score4" min="0" max="15" oninput="calculateInstitute('kwu')" required>
          </td>
        </tr>

        <!-- í•©ê³„ -->
        <tr class="total-row">
          <td colspan="3" data-label="í•©ê³„">í•© ê³„</td>
          <td data-label="ì´ë°°ì ">100</td>
          <td data-label="í•œêµ­ì „ìê¸°ìˆ ì—°êµ¬ì› í•©ê³„"><span id="keti_total">0</span></td>
          <td data-label="ì¸í•˜ëŒ€í•™êµ í•©ê³„"><span id="inha_total">0</span></td>
          <td data-label="í•œêµ­í•­ê³µëŒ€í•™êµ í•©ê³„"><span id="kau_total">0</span></td>
          <td data-label="ê´‘ìš´ëŒ€í•™êµ í•©ê³„"><span id="kwu_total">0</span></td>
        </tr>
      </tbody>
    </table>

    <!-- âœï¸ ì„œëª… ì„¹ì…˜ -->
    <div class="signature-section">
      <h3>âœï¸ ì‹¬ì‚¬ìœ„ì› ì„œëª…</h3>
      <p style="color: #666; font-size: 14px;">ì•„ë˜ ìº”ë²„ìŠ¤ì— ë§ˆìš°ìŠ¤ë‚˜ ì†ê°€ë½ìœ¼ë¡œ ì„œëª…í•´ì£¼ì„¸ìš”</p>
      <canvas id="signatureCanvas" width="600" height="200"></canvas>
      <div class="signature-buttons">
        <button type="button" id="clearBtn">ì„œëª… ì§€ìš°ê¸°</button>
      </div>
      <input type="hidden" id="signatureData" name="signature">
    </div>

    <br>
    <button type="submit">ì „ì²´ ì ìˆ˜ ì œì¶œí•˜ê¸°</button>
  </form>
  
  <div id="message"></div>

  <script>
    // ================================
    // ì„œëª… ìº”ë²„ìŠ¤ ì„¤ì •
    // ================================
    const canvas = document.getElementById('signatureCanvas');
    const ctx = canvas.getContext('2d');
    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;

    ctx.strokeStyle = '#000';
    ctx.lineWidth = 2;
    ctx.lineCap = 'round';
    ctx.lineJoin = 'round';

    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);
    canvas.addEventListener('touchstart', handleTouchStart);
    canvas.addEventListener('touchmove', handleTouchMove);
    canvas.addEventListener('touchend', stopDrawing);

    function startDrawing(e) {
      isDrawing = true;
      const rect = canvas.getBoundingClientRect();
      lastX = e.clientX - rect.left;
      lastY = e.clientY - rect.top;
    }

    function draw(e) {
      if (!isDrawing) return;
      const rect = canvas.getBoundingClientRect();
      const currentX = e.clientX - rect.left;
      const currentY = e.clientY - rect.top;
      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(currentX, currentY);
      ctx.stroke();
      lastX = currentX;
      lastY = currentY;
    }

    function stopDrawing() {
      isDrawing = false;
    }

    function handleTouchStart(e) {
      e.preventDefault();
      const touch = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      isDrawing = true;
      lastX = touch.clientX - rect.left;
      lastY = touch.clientY - rect.top;
    }

    function handleTouchMove(e) {
      e.preventDefault();
      if (!isDrawing) return;
      const touch = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      const currentX = touch.clientX - rect.left;
      const currentY = touch.clientY - rect.top;
      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(currentX, currentY);
      ctx.stroke();
      lastX = currentX;
      lastY = currentY;
    }

    document.getElementById('clearBtn').addEventListener('click', function() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      document.getElementById('signatureData').value = '';
    });

    // ================================
    // í•©ê³„ ê³„ì‚° ìŠ¤í¬ë¦½íŠ¸
    // ================================
    function calculateInstitute(prefix) {
      let total = 0;
      
      // ëª¨ë“  ê¸°ê´€ì´ 4ê°œ í•­ëª© í‰ê°€
      for (let i = 1; i <= 4; i++) {
        const input = document.querySelector(`input[name='${prefix}_score${i}']`);
        if (input) {
          total += parseFloat(input.value) || 0;
        }
      }
      
      document.getElementById(`${prefix}_total`).textContent = total;
    }

    // ================================
    // í¼ ì œì¶œ ìŠ¤í¬ë¦½íŠ¸
    // ================================
    document.getElementById("scoreForm").addEventListener("submit", function(e) {
      e.preventDefault();
      
      const signatureDataUrl = canvas.toDataURL('image/png');
      const isCanvasBlank = !ctx.getImageData(0, 0, canvas.width, canvas.height).data.some(channel => channel !== 0);
      
      if (isCanvasBlank) {
        alert('ì„œëª…ì„ ì‘ì„±í•´ì£¼ì„¸ìš”!');
        return;
      }
      
      document.getElementById('signatureData').value = signatureDataUrl;
      
      var messageDiv = document.getElementById("message");
      messageDiv.textContent = "ì œì¶œ ì¤‘ì…ë‹ˆë‹¤... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.";
      messageDiv.style.color = "blue";
      
      var webAppUrl = "https://script.google.com/macros/s/AKfycbyd7WgMJAJ9e7Gvz3sspCLPDN5kRWzPX8calCO4jUdD77lN9_eBjIU8omHuIVcnUy1N/exec"; 
      
      var formData = new FormData(this); 
      
      fetch(webAppUrl, {
        method: "POST",
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if(data.result === "success") {
          messageDiv.textContent = "âœ” ì ìˆ˜ ì œì¶œì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤!";
          messageDiv.style.color = "green";
          document.getElementById("scoreForm").reset();
          ctx.clearRect(0, 0, canvas.width, canvas.height);
        } else {
          messageDiv.textContent = "âŒ ì˜¤ë¥˜ ë°œìƒ: " + data.message;
          messageDiv.style.color = "red";
        }
      })
      .catch(error => {
        messageDiv.textContent = "âŒ ì „ì†¡ ì˜¤ë¥˜: " + error;
        messageDiv.style.color = "red";
      });
    });
  </script>
</body>
</html>
