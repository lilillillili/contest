<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* ---------------------------------- */
    /* ğŸ¨ ê¸°ë³¸ ìŠ¤íƒ€ì¼ (ë°ìŠ¤í¬íƒ‘) */
    /* ---------------------------------- */
    body { font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif; margin: 20px; }
    h2 { padding-bottom: 10px; border-bottom: 2px solid #333; }
    table { border-collapse: collapse; width: 100%; table-layout: fixed; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; height: 40px; }
    th { background-color: #f4f4f4; }
    td:nth-child(1), td:nth-child(2), td:nth-child(3), td:nth-child(4) {
      background-color: #fafafa;
      font-weight: bold;
      font-size: 15px;
    }
    input[type="number"] { 
      width: 95%; 
      padding: 8px; 
      font-size: 16px; 
      box-sizing: border-box;
      text-align: center;
    }
    th:last-child, td:last-child { width: 10%; } 
    td span { font-weight: bold; font-size: 16px; } 
    button { 
      padding: 12px 25px; 
      background-color: #4d79ff; 
      color: white; 
      border: none; 
      cursor: pointer; 
      font-size: 16px; 
      font-weight: bold; 
      margin-top: 15px;
    }
    button:hover { background-color: #3a5bcc; }
    #message { margin-top: 15px; font-weight: bold; font-size: 16px; }
    .judge-section { margin-bottom: 15px; }
    .judge-section label { font-size: 16px; font-weight: bold; }
    .judge-section input { width: 250px; text-align: left; padding: 8px; font-size: 15px; }

    /* ---------------------------------- */
    /* âœï¸ ì„œëª… ìº”ë²„ìŠ¤ ìŠ¤íƒ€ì¼ */
    /* ---------------------------------- */
    .signature-section {
      margin-top: 30px;
      border: 2px solid #4d79ff;
      padding: 20px;
      border-radius: 8px;
    }
    .signature-section h3 {
      margin-top: 0;
      color: #333;
    }
    #signatureCanvas {
      border: 2px solid #333;
      cursor: crosshair;
      display: block;
      margin: 10px auto;
      background-color: white;
      touch-action: none; /* ëª¨ë°”ì¼ì—ì„œ ìŠ¤í¬ë¡¤ ë°©ì§€ */
    }
    .signature-buttons {
      text-align: center;
      margin-top: 10px;
    }
    .signature-buttons button {
      margin: 0 5px;
      padding: 10px 20px;
      font-size: 14px;
    }
    #clearBtn {
      background-color: #ff6b6b;
    }
    #clearBtn:hover {
      background-color: #cc5555;
    }

    /* ---------------------------------- */
    /* ğŸ“± ëª¨ë°”ì¼ ë°˜ì‘í˜• 'ë§ˆë²•' ì½”ë“œ  */
    /* (í™”ë©´ ë„ˆë¹„ê°€ 768pxë³´ë‹¤ ì¢ì•„ì§€ë©´ ì‘ë™) */
    /* ---------------------------------- */
    @media (max-width: 768px) {
      /* 1. ë°ìŠ¤í¬íƒ‘ìš© ì›ë³¸ í—¤ë”(ì œëª© ì¤„) ìˆ¨ê¸°ê¸° */
      table thead {
        display: none;
      }
      
      /* 2. í‘œì˜ ëª¨ë“  ìš”ì†Œë¥¼ ì„¸ë¡œë¡œ ìŒ“ê¸°(Block) */
      table, tbody, tr, td {
        display: block;
        width: 100%;
        box-sizing: border-box;
      }
      
      /* 3. í•œ 'ì¤„(tr)'ì„ í•˜ë‚˜ì˜ 'ì¹´ë“œ'ì²˜ëŸ¼ ë³´ì´ê²Œ í•¨ */
      tbody tr {
        margin-bottom: 15px;
        border: 2px solid #4d79ff;
        padding: 5px;
      }
      
      /* 4. ê° 'ì¹¸(td)'ì˜ ìŠ¤íƒ€ì¼ ë³€ê²½ */
      tbody td {
        padding-left: 45%;
        text-align: right;
        position: relative;
        height: auto;
        border: none;
        border-bottom: 1px dotted #ccc;
      }
      
      /* 5. ê° ì¹´ë“œì˜ ë§ˆì§€ë§‰ ì¹¸ì€ ì ì„  ì—†ìŒ */
      tbody td:last-child {
        border-bottom: 0;
      }
      
      /* 6. ğŸª„ 'data-label'ì„ ê°€ì ¸ì™€ì„œ ì™¼ìª½ì— í—¤ë”ì²˜ëŸ¼ ë¶™ì—¬ì£¼ê¸° */
      tbody td:before {
        content: attr(data-label); 
        position: absolute;
        left: 10px;
        width: calc(45% - 15px);
        text-align: left;
        font-weight: bold;
        white-space: nowrap;
        font-size: 14px;
        color: #333;
      }

      /* 7. ì…ë ¥ì¹¸ë“¤ 100% ë„ˆë¹„ë¡œ */
      input[type="number"], input[type="text"], select {
          width: 100%;
          font-size: 16px;
      }
      
      /* 8. ë¯¸ë¦¬ ì±„ì›Œì§„ ì¹¸ë“¤ ìŠ¤íƒ€ì¼ ëª¨ë°”ì¼ìš©ìœ¼ë¡œ ì´ˆê¸°í™” */
      td:nth-child(1), td:nth-child(2), td:nth-child(3), td:nth-child(4) {
        background-color: transparent;
        font-weight: normal;
        text-align: right;
      }

      /* 9. ì„œëª… ìº”ë²„ìŠ¤ ëª¨ë°”ì¼ ëŒ€ì‘ */
      #signatureCanvas {
        width: 100%;
        height: 200px;
      }
    }
  </style>
</head>
<body>

  <h2>ì‹¬ì‚¬ ì ìˆ˜ ì…ë ¥ (ë°˜ì‘í˜•)</h2>
  
  <form id="scoreForm">
    <div class="judge-section">
      <label for="judgeName">ì‹¬ì‚¬ìœ„ì› ì„±ëª…: </label>
      <input type="text" id="judgeNameInput" name="judgeName" required>
    </div>

    <table>
      <thead>
        <tr>
          <th>êµ¬ë¶„</th>
          <th>ë‹¨ì²´ëª…</th>
          <th>ëŒ€í‘œì</th>
          <th>ì§ìœ„</th>
          <th>ì—°êµ¬ê°œë°œì‹¤ì <br>(-30)</th>
          <th>í˜‘ë ¥ì°¸ì—¬ë„<br>(-30)</th>
          <th>êµ­ê°€ê²½ì œê¸°ì—¬ë„<br>(-40)</th>
          <th>í•©ê³„<br>(-100)</th>
        </tr>
      </thead>
      <tbody>
        <tr data-label="1ë²ˆ íŒ€">
          <td data-label="êµ¬ë¶„">
            í•™ê³„
            <input type="hidden" name="group1_gubun" value="í•™ê³„">
          </td>
          <td data-label="ë‹¨ì²´ëª…">
            ìŠ¤íŠ¸ë ˆì´í‚¤ì¦ˆ
            <input type="hidden" name="group1_name" value="ìŠ¤íŠ¸ë ˆì´í‚¤ì¦ˆ">
          </td>
          <td data-label="ëŒ€í‘œì">
            í•„ë¦­ìŠ¤
            <input type="hidden" name="group1_rep" value="í•„ë¦­ìŠ¤">
          </td>
          <td data-label="ì§ìœ„">
            ì–¼êµ´ì€ì„ ë…€ëª¸ì€ë‚˜ë¬´ê¾¼
            <input type="hidden" name="group1_pos" value="ì–¼êµ´ì€ì„ ë…€ëª¸ì€ë‚˜ë¬´ê¾¼">
          </td>
          <td data-label="ì—°êµ¬ê°œë°œì‹¤ì (-30)"><input type="number" name="group1_score1" min="0" max="30" oninput="calculateTotal(1)" required></td>
          <td data-label="í˜‘ë ¥ì°¸ì—¬ë„(-30)"><input type="number" name="group1_score2" min="0" max="30" oninput="calculateTotal(1)" required></td>
          <td data-label="êµ­ê°€ê²½ì œê¸°ì—¬ë„(-40)"><input type="number" name="group1_score3" min="0" max="40" oninput="calculateTotal(1)" required></td>
          <td data-label="í•©ê³„(-100)"><span id="group1_total">0</span></td>
        </tr>
        
        <tr data-label="2ë²ˆ íŒ€">
          <td data-label="êµ¬ë¶„">
            ì‚°ì—…ê³„
            <input type="hidden" name="group2_gubun" value="ì‚°ì—…ê³„">
          </td>
          <td data-label="ë‹¨ì²´ëª…">
            ìŠ¤í‚¤ì¦ˆ
            <input type="hidden" name="group2_name" value="ìŠ¤í‚¤ì¦ˆ">
          </td>
          <td data-label="ëŒ€í‘œì">
            í•œì§€ì„±
            <input type="hidden" name="group2_rep" value="í•œì§€ì„±">
          </td>
          <td data-label="ì§ìœ„">
            ì˜¬ë¼ìš´ë“œ ë˜í¼
            <input type="hidden" name="group2_pos" value="ì˜¬ë¼ìš´ë“œ ë˜í¼">
          </td>
          <td data-label="ì—°êµ¬ê°œë°œì‹¤ì (-30)"><input type="number" name="group2_score1" min="0" max="30" oninput="calculateTotal(2)" required></td>
          <td data-label="í˜‘ë ¥ì°¸ì—¬ë„(-30)"><input type="number" name="group2_score2" min="0" max="30" oninput="calculateTotal(2)" required></td>
          <td data-label="êµ­ê°€ê²½ì œê¸°ì—¬ë„(-40)"><input type="number" name="group2_score3" min="0" max="40" oninput="calculateTotal(2)" required></td>
          <td data-label="í•©ê³„(-100)"><span id="group2_total">0</span></td>
        </tr>
        
        <tr data-label="3ë²ˆ íŒ€">
          <td data-label="êµ¬ë¶„">
            ì—°êµ¬ì†Œ
            <input type="hidden" name="group3_gubun" value="ì—°êµ¬ì†Œ">
          </td>
          <td data-label="ë‹¨ì²´ëª…">
            SKZ
            <input type="hidden" name="group3_name" value="SKZ">
          </td>
          <td data-label="ëŒ€í‘œì">
            ê¹€ìŠ¹ë¯¼
            <input type="hidden" name="group3_rep" value="ê¹€ìŠ¹ë¯¼">
          </td>
          <td data-label="ì§ìœ„">
            ë©”ë³´ëª…ì°½ê°•ì¥
            <input type="hidden" name="group3_pos" value="ë©”ë³´ëª…ì°½ê°•ì¥">
          </td>
          <td data-label="ì—°êµ¬ê°œë°œì‹¤ì (-30)"><input type="number" name="group3_score1" min="0" max="30" oninput="calculateTotal(3)" required></td>
          <td data-label="í˜‘ë ¥ì°¸ì—¬ë„(-30)"><input type="number" name="group3_score2" min="0" max="30" oninput="calculateTotal(3)" required></td>
          <td data-label="êµ­ê°€ê²½ì œê¸°ì—¬ë„(-40)"><input type="number" name="group3_score3" min="0" max="40" oninput="calculateTotal(3)" required></td>
          <td data-label="í•©ê³„(-100)"><span id="group3_total">0</span></td>
        </tr>
      </tbody>
    </table>

    <!-- âœï¸ ì„œëª… ì„¹ì…˜ ì¶”ê°€ -->
    <div class="signature-section">
      <h3>âœï¸ ì‹¬ì‚¬ìœ„ì› ì„œëª…</h3>
      <p style="color: #666; font-size: 14px;">ì•„ë˜ ìº”ë²„ìŠ¤ì— ë§ˆìš°ìŠ¤ë‚˜ ì†ê°€ë½ìœ¼ë¡œ ì„œëª…í•´ì£¼ì„¸ìš”</p>
      <canvas id="signatureCanvas" width="600" height="200"></canvas>
      <div class="signature-buttons">
        <button type="button" id="clearBtn">ì„œëª… ì§€ìš°ê¸°</button>
      </div>
      <input type="hidden" id="signatureData" name="signature">
    </div>

    <br>
    <button type="submit">ì „ì²´ ì ìˆ˜ ì œì¶œí•˜ê¸°</button>
  </form>
  
  <div id="message"></div>

  <script>
    // ================================
    // ì„œëª… ìº”ë²„ìŠ¤ ì„¤ì •
    // ================================
    const canvas = document.getElementById('signatureCanvas');
    const ctx = canvas.getContext('2d');
    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;

    // ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
    ctx.strokeStyle = '#000';
    ctx.lineWidth = 2;
    ctx.lineCap = 'round';
    ctx.lineJoin = 'round';

    // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ (ë°ìŠ¤í¬íƒ‘)
    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);

    // í„°ì¹˜ ì´ë²¤íŠ¸ (ëª¨ë°”ì¼)
    canvas.addEventListener('touchstart', handleTouchStart);
    canvas.addEventListener('touchmove', handleTouchMove);
    canvas.addEventListener('touchend', stopDrawing);

    function startDrawing(e) {
      isDrawing = true;
      const rect = canvas.getBoundingClientRect();
      lastX = e.clientX - rect.left;
      lastY = e.clientY - rect.top;
    }

    function draw(e) {
      if (!isDrawing) return;
      
      const rect = canvas.getBoundingClientRect();
      const currentX = e.clientX - rect.left;
      const currentY = e.clientY - rect.top;

      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(currentX, currentY);
      ctx.stroke();

      lastX = currentX;
      lastY = currentY;
    }

    function stopDrawing() {
      isDrawing = false;
    }

    function handleTouchStart(e) {
      e.preventDefault();
      const touch = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      isDrawing = true;
      lastX = touch.clientX - rect.left;
      lastY = touch.clientY - rect.top;
    }

    function handleTouchMove(e) {
      e.preventDefault();
      if (!isDrawing) return;
      
      const touch = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      const currentX = touch.clientX - rect.left;
      const currentY = touch.clientY - rect.top;

      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(currentX, currentY);
      ctx.stroke();

      lastX = currentX;
      lastY = currentY;
    }

    // ì„œëª… ì§€ìš°ê¸° ë²„íŠ¼
    document.getElementById('clearBtn').addEventListener('click', function() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      document.getElementById('signatureData').value = '';
    });

    // ================================
    // í•©ê³„ ê³„ì‚° ìŠ¤í¬ë¦½íŠ¸
    // ================================
    function calculateTotal(rowNum) {
      var prefix = "group" + rowNum; 
      var s1 = parseFloat(document.querySelector("input[name='" + prefix + "_score1']").value) || 0;
      var s2 = parseFloat(document.querySelector("input[name='" + prefix + "_score2']").value) || 0;
      var s3 = parseFloat(document.querySelector("input[name='" + prefix + "_score3']").value) || 0;
      var total = s1 + s2 + s3;
      document.getElementById(prefix + "_total").textContent = total;
    }

    // ================================
    // í¼ ì œì¶œ ìŠ¤í¬ë¦½íŠ¸
    // ================================
    document.getElementById("scoreForm").addEventListener("submit", function(e) {
      e.preventDefault();
      
      // ì„œëª… í™•ì¸
      const signatureDataUrl = canvas.toDataURL('image/png');
      const isCanvasBlank = !ctx.getImageData(0, 0, canvas.width, canvas.height).data.some(channel => channel !== 0);
      
      if (isCanvasBlank) {
        alert('ì„œëª…ì„ ì‘ì„±í•´ì£¼ì„¸ìš”!');
        return;
      }
      
      // ì„œëª… ë°ì´í„°ë¥¼ hidden inputì— ì €ì¥
      document.getElementById('signatureData').value = signatureDataUrl;
      
      var messageDiv = document.getElementById("message");
      messageDiv.textContent = "ì œì¶œ ì¤‘ì…ë‹ˆë‹¤... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.";
      messageDiv.style.color = "blue";
      
      var webAppUrl = "https://script.google.com/macros/s/AKfycbzF7IQLjznDmCyLxc0Iaj-D3FYJPcvM7j6yoNONMADDF4sw_8YgfxJfQvDPqwEnkxKP/exec"; 
      
      var formData = new FormData(this); 
      
      fetch(webAppUrl, {
        method: "POST",
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if(data.result === "success") {
          messageDiv.textContent = "âœ” ì ìˆ˜ ì œì¶œì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤!";
          messageDiv.style.color = "green";
          // ì œì¶œ ì„±ê³µ ì‹œ í¼ ì´ˆê¸°í™”
          document.getElementById("scoreForm").reset();
          ctx.clearRect(0, 0, canvas.width, canvas.height);
        } else {
          messageDiv.textContent = "âŒ ì˜¤ë¥˜ ë°œìƒ: " + data.message;
          messageDiv.style.color = "red";
        }
      })
      .catch(error => {
        messageDiv.textContent = "âŒ ì „ì†¡ ì˜¤ë¥˜: " + error;
        messageDiv.style.color = "red";
      });
    });
  </script>
</body>
</html>